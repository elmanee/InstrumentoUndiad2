<!-- product-card.component.html -->
<div class="container mt-4">
  <h2 class="mb-4">Catálogo de Productos</h2>

  <!-- Búsqueda y Filtros -->
  <div class="search-container">
    <!-- Left side - Search controls -->
    <div class="search-controls">
      <select class="search-type-select" [(ngModel)]="searchType">
        <option value="nombre">Por Nombre</option>
        <option value="codigo">Por Código</option>
        <option value="marca">Por Marca</option>
        <option value="tamanio">Por Tamaño</option>
        <option value="pasillo">Por Pasillo</option>
        <option value="precio">Por Precio</option>
      </select>

      <ng-container *ngIf="searchType !== 'precio'">
        <input
          type="text"
          class="search-input"
          [placeholder]="getPlaceholderText()"
          [(ngModel)]="searchTerm"
          (ngModelChange)="onSearchTermChange()">
      </ng-container>

      <ng-container *ngIf="searchType === 'precio'">
        <div class="price-range-container">
          <input
            type="number"
            class="price-input"
            placeholder="Precio mínimo"
            [(ngModel)]="precioMin"
            (ngModelChange)="onPriceInputChange()">
          <input
            type="number"
            class="price-input"
            placeholder="Precio máximo"
            [(ngModel)]="precioMax"
            (ngModelChange)="onPriceInputChange()">
        </div>
      </ng-container>

      <button class="search-button" type="button" (click)="buscarProductos()">
        <i class="bi bi-search"></i>
        <span>Buscar</span>
      </button>
    </div>

    <!-- Right side - Filters -->
    <div class="filter-controls">
      <select class="status-filter" [(ngModel)]="filtroEstatus" (change)="aplicarFiltrosYBusqueda()">
        <option value="todos">Todos los productos</option>
        <option value="activo">Solo activos</option>
        <option value="inactivo">Solo inactivos</option>
      </select>

      <button class="reset-button" (click)="resetFilters()">
        <i class="bi bi-arrow-counterclockwise"></i>
        <span>Mostrar todos</span>
      </button>
    </div>
  </div>

  <!-- Productos en cards -->
  <div class="row row-cols-1 row-cols-md-3 g-4">
    <div class="col" *ngFor="let producto of productosFiltrados">
      <div class="card h-100" [ngClass]="{'border-success': producto.estatus === 'activo', 'border-danger': producto.estatus === 'inactivo'}">
        <div class="card-header d-flex justify-content-between align-items-center"
             [ngClass]="{'bg-success text-white': producto.estatus === 'activo', 'bg-danger text-white': producto.estatus === 'inactivo'}">
          <h5 class="card-title mb-0">{{producto.nombre_producto}}</h5>
          <span class="badge" [ngClass]="{'bg-light text-success': producto.estatus === 'activo', 'bg-light text-danger': producto.estatus === 'inactivo'}">
            {{producto.estatus === 'activo' ? 'Activo' : 'Inactivo'}}
          </span>
        </div>

        <!-- Imagen del producto -->
        <div class="card-img-container">
          <img
            [src]="producto.imagen ? 'http://localhost:3000' + getImageUrl(producto.imagen) : 'assets/images/producto-default.jpg'"
            class="card-img-top product-image"
            [alt]="producto.nombre_producto"
            (error)="onImageError($event)">
          <div class="status-indicator" [ngClass]="{'active': producto.estatus === 'activo', 'inactive': producto.estatus === 'inactivo'}"></div>
        </div>

        <div class="card-body">
          <p class="card-text"><strong>Código:</strong> {{producto.codigo_barras}}</p>
          <p class="card-text"><strong>Estatus:</strong> {{producto.estatus}}</p>
          <p class="card-text"><strong>Pasillo:</strong> {{producto.pasillo}}</p>
          <p class="card-text"><strong>Precio por pieza:</strong> {{producto.precio_pieza}}</p>
          <p class="card-text"><strong>Marca:</strong> {{producto.marca}}</p>
          <p class="card-text"><strong>Tamaño:</strong> {{producto.tamanio}}</p>


          <div class="row mb-2">
            <div class="col-6">
              <p class="card-text"><strong>Stock Exhibe:</strong> {{producto.stock_exhibe}}</p>
            </div>
            <div class="col-6">
              <p class="card-text"><strong>En exhibición:</strong> {{producto.existencia_exhibe}}</p>
            </div>
          </div>
          <div class="d-grid gap-2">
            <button class="btn btn-primary" [disabled]="producto.estatus !== 'activo'" (click)="abrirModalEdicion(producto)">
              <i class="bi bi-pencil-square"></i> Editar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Paginación -->

</div>

<!-- Modal de edición -->
<div class="modal fade" id="editarProductoModal" tabindex="-1" aria-labelledby="editarProductoModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="editarProductoModalLabel">Actualizar Producto</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <form *ngIf="productoSeleccionado">
          <!-- Product information -->
          <div class="mb-3">
            <label for="nombreProducto" class="form-label">Nombre producto</label>
            <input type="text" class="form-control" id="nombreProducto" [(ngModel)]="productoSeleccionado.nombre_producto" name="nombre_producto" readonly>
          </div>

          <!-- Current inventory status -->
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="existenciaAlmacen" class="form-label">Existencia en almacén</label>
                <input type="number" class="form-control" id="existenciaAlmacen"
                      [(ngModel)]="productoSeleccionado.existencia_almacen"
                      name="existencia_almacen" readonly>
                <small class="form-text text-muted">Inventario disponible</small>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="existenciaExhibe" class="form-label">Existencia en exhibición</label>
                <input type="number" class="form-control" id="existenciaExhibe"
                      [(ngModel)]="productoSeleccionado.existencia_exhibe"
                      name="existencia_exhibe" readonly>
                <small class="form-text text-muted">Cantidad actual en exhibición</small>
              </div>
            </div>
          </div>

          <!-- Editable fields -->
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="stockExhibe" class="form-label">Stock objetivo</label>
                <input type="number" class="form-control" id="stockExhibe"
                      [(ngModel)]="productoSeleccionado.stock_exhibe"
                      name="stock_exhibe" readonly>
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="cantidadRellenar" class="form-label">Cantidad a transferir</label>
                <input type="number" class="form-control" id="cantidadRellenar"
                      [(ngModel)]="productoSeleccionado.cantidad_rellenar"
                      name="cantidad_rellenar"
                      min="0"
                      [max]="productoSeleccionado.existencia_almacen">
                <small class="form-text text-muted">Esta cantidad se transferirá de almacén a exhibición</small>
              </div>
            </div>
          </div>
        </form>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button type="button" class="btn btn-primary" (click)="actualizarProducto()">Actualizar</button>
      </div>
    </div>
  </div>
</div>
